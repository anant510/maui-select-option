@page "/table"

<h3>Table</h3>

<div class="container">
    <div class="col-md-12">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th scope="col">#</th>
                  
                    <th scope="col">Last</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var person in people)
                {
                    <tr>
                        @if (person != null)
                        {
                            <th scope="row">@person.Id</th>
                        }
                   
                        <td>@person.LastName</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>


<h3>Create New Person</h3>

<div class="container">
    <form @onsubmit="HandleSubmit">
        <div class="mb-3">
            <label for="firstName" class="form-label">First Name</label>
            <input type="text" class="form-control" id="firstName" @bind="newPerson.FirstName">
        </div>
        <div class="mb-3">
            <label for="list" class="form-label">List</label>
            <InputSelect @bind-Value="selectedPerson" class="form-control">
                @foreach (var person in people)
                {
                    <option value="@person" @key="@person.Id">@person.LastName</option>
                }
            </InputSelect>
           

        </div>
        <button type="submit" class="btn btn-primary">Create</button>
    </form>

</div>




@code {


    public class Person
    {
        public int Id { get; set; }
        public string FirstName { get; set; }
        public string LastName { get; set; }
    }

    private int selectedPersonId; 


    private Person newPerson = new Person();

    private Person selectedPerson;

    private List<Person> people;


    protected override void OnInitialized()
    {
        string jsonData = @"
        [
            { ""Id"": 1, ""FirstName"": ""Mark"", ""LastName"": ""Otto"" },
            { ""Id"": 2, ""FirstName"": ""Jacob"", ""LastName"": ""Thornton"" },
            { ""Id"": 3, ""FirstName"": ""Larry"", ""LastName"": ""Bird"" }
        ]";

        people = System.Text.Json.JsonSerializer.Deserialize<List<Person>>(jsonData);
    }


    private void HandleSubmit()
    {
        // Calculate newId by checking if people list is null or empty
        int newId = people != null && people.Any() ? people.Max(p => p.Id) + 1 : 1;

    
        if (selectedPerson != null)
        {
            selectedPerson.Id = newId;
            selectedPerson.FirstName = newPerson.FirstName;
            //selectedPerson.LastName = selectedPerson.ToString
            selectedPerson.LastName = selectedPerson.LastName.ToString();
        }
        else
        {
            selectedPerson = new Person
                {
                    Id = newId,
                    FirstName = newPerson.FirstName,
                    LastName = newPerson.LastName
                };
        }

        people.Add(selectedPerson);

        // Reset the form
        //newPerson = new Person();

        // Serialize updated list to JSON format
        string jsonData = System.Text.Json.JsonSerializer.Serialize(people);
        Console.WriteLine(jsonData); // This is where you can use or save the JSON data as needed
    }

}
